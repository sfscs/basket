!function(){function a(){function a(a,b){localStorage.setItem(d+a,JSON.stringify(b))}function b(a){return JSON.parse(localStorage.getItem(d+a))}function c(){localStorage.clear(),localStorage.removeItem(d+"auto_increment"),localStorage.removeItem(d+"users"),localStorage.removeItem(d+"lists"),localStorage.removeItem(d+"items"),localStorage.removeItem(d+"comments")}var d="basket_";return{get:b,set:a,clearAll:c}}function b(a){function b(){d=parseInt(a.get("auto_increment"))}function c(){return d+=1,a.set("auto_increment",d),d-1}var d;return{init:b,newId:c}}function c(a,b){function c(){lists.data=b.get("lists")}function d(a,b){var c=g(b),d=f(b);d.shared_with.push(a),lists.data[c]=d,l()}function e(a,b){var c=g(b),d=f(b),e=d.shared_with.indexOf(a);d.shared_with.splice(e,1),lists.data[c]=d,l()}function f(a){return lists.data[g(a)]}function g(a){var b=lists.data.filter(function(b){return b.id===a})[0],c=lists.data.indexOf(b);return c}function h(a,b,c){var d=lists.getListIdx(a);lists.data[d][b]=c,l()}function i(b,c){return{id:a.newId(),name:c.trim(),owner_id:b,list_type:"normal",shared_with:[],added_date:Date.now()}}function j(a){lists.data.push(a),l()}function k(a){lists.data.splice(g(a),1),l()}function l(){b.set("lists",lists.data)}return lists={},lists.data=[],lists.init=c,lists.add=j,lists.remove=k,lists.createNew=i,lists.getListById=f,lists.getListIdx=g,lists.editList=h,lists.shareList=d,lists.unShareList=e,lists}function d(a,b){function c(){users.data=b.get("users")}function d(a,b,c){var d=users.getUserIdx(a);users.data[d][b]=c,j()}function e(a){return users.data[f(a)]}function f(a){var b=users.data.filter(function(b){return b.id===a})[0],c=users.data.indexOf(b);return c}function g(b){return{id:a.newId(),name:b.trim(),last_list:""}}function h(a){users.data.push(a),j()}function i(a){users.data.splice(f(a),1),j()}function j(){b.set("users",users.data)}return users={},users.data=[],users.init=c,users.editUser=d,users.add=h,users.remove=i,users.createNew=g,users.getUserById=e,users.getUserIdx=f,users.saveToStorage=j,users}function e(a,b){function c(){items.data=b.get("items")}function d(a){return items.data[e(a)]}function e(a){var b=items.data.filter(function(b){return b.id===a})[0],c=items.data.indexOf(b);return c}function f(a){var b=[];return angular.forEach(items.data,function(b){b.list_id===a&&this.push(b)},b),b}function g(a,b,c){var d=items.getItemIdx(a);items.data[d][b]=c,k()}function h(b,c,d){return{id:a.newId(),name:d.trim(),is_checked:!1,owner_id:b,list_id:c,assigned_to_id:b,added_date:Date.now()}}function i(a){items.data.push(a),k()}function j(a){items.data.splice(e(a),1),k()}function k(){b.set("items",items.data)}return items={},items.data=[],items.init=c,items.add=i,items.remove=j,items.createNew=h,items.getItemById=d,items.getItemIdx=e,items.getItemsByListId=f,items.editItem=g,items}function f(a,b){function c(){comments.data=b.get("comments")}function d(a){var b=comments.data.filter(function(b){return b.id===a})[0],c=comments.data.indexOf(b);return c}function e(b,c,d){return{id:a.newId(),comment:d,item_id:c,owner_id:b,added_date:Date.now()}}function f(a){var b=[];return angular.forEach(comments.data,function(b){b.item_id===a&&this.push(b)},b),b}function g(a){comments.data.push(a),i()}function h(a){comments.data.splice(d(a),1),i()}function i(){b.set("comments",comments.data)}return comments={},comments.data=[],comments.init=c,comments.add=g,comments.remove=h,comments.createNew=e,comments.getCommentsByItemId=f,comments}function g(a,b,c){a.users=c.data,a.selectUser=function(a){b.go("user.lists",{userId:a.id})},a.addUser=function(a){var b=c.createNew(a);c.add(b)}}function h(a,b,c,d,e,f){function g(a){d.add(d.createNew(c.userId,a))}function h(a){return f.getItemsByListId(a).length}function i(){a.newUserName=a.user.name,a.isEditingUserName=!0}function j(){a.isEditingUserName=!1}function k(b){b.trim()?(e.editUser(a.user.id,"name",b.trim()),a.newUserName=a.user.name,a.isEditingUserName=!1):j()}function l(){e.remove(a.user.id),b.go("users")}function m(){b.go("user.edit")}function n(a){b.go("list.items",{userId:c.userId,listId:a.id})}function o(){switch(b.current.name){case"user.lists":b.go("users");break;case"user.edit":b.go("user.lists")}}a.lists=d.data,a.user=e.getUserById(c.userId),a.addList=g,a.getUser=e.getUserById,a.countItems=h,a.newUserName=a.user.name,a.isEditingUserName=!1,a.startUserNameEdit=i,a.cancelUserNameEdit=j,a.saveUserNameEdit=k,a.deleteUser=l,a.goBack=o,a.userEdit=m,a.selectList=n}function i(a,b,c,d,e,f,g,h,i,j,k){function l(a){var b=f.createNew(c.userId,c.listId,a.trim());f.add(b)}function m(){a.isEditingListName=!0}function n(b){b.trim()?(d.editList(a.list.id,"name",b.trim()),a.newListName=a.list.name,a.isEditingListName=!1):a.cancelListNameEdit()}function o(){a.newListName=a.list.name,a.isEditingListName=!1}function p(){d.remove(a.list.id),b.go("user.lists",{userId:c.userId})}function q(a){var b=g.getCommentsByItemId(a);return b.length}function r(){switch(b.current.name){case"list.edit":b.go("list.items");break;case"list.items":b.go("user.lists",{userId:c.userId})}}function s(){b.go("list.edit")}function t(a,b){var d=g.createNew(c.userId,a,b);g.add(d)}function u(a){var b=e.getUserById(a.owner_id);return b}function v(b){return-1===a.list.shared_with.indexOf(b)?!1:!0}function w(b){a.isSharedWith(b)?d.unShareList(b,a.list.id):d.shareList(b,a.list.id)}function x(b){var c=a,d=k("itemInList")(c.items,c.list.id),f="*** "+c.list.name+" ***\n\n",g=j("{{what}} - (assigned to {{who}}) - {{isDone}}\n");angular.forEach(d,function(a){var b="not purchased";a.is_checked&&(b="purchased!");var c=e.getUserById(a.assigned_to_id),d={what:a.name,who:c.name,isDone:b};f+=g(d)}),f=f+"\n*** "+c.currentUser.name+" | "+Date()+" ***\n";var l={subject:c.list.name,body:f},m=h.url(b,l);i.open(m)}a.items=f.data,a.users=e.data,a.comments=g.data,a.currentUser=e.getUserById(c.userId),a.list=d.getListById(c.listId),a.getUser=e.getUserById,a.addItem=l,a.isEditingListName=!1,a.newListName=a.list.name,a.startListNameEdit=m,a.saveListNameEdit=n,a.cancelListNameEdit=o,a.deleteList=p,a.goBack=r,a.listEdit=s,a.countComments=q,a.addComment=t,a.getCommentOwner=u,a.isSharedWith=v,a.toggleShare=w,a.emailList=x}function j(a,b){function c(c){a.itemCheck=c,b.editItem(a.item.id,"is_checked",c)}function d(){a.isEditing=!0}function e(c){c.trim()?(b.editItem(a.item.id,"name",c.trim()),a.newItemName=a.item.name,a.isEditing=!1):a.cancelItemEdit()}function f(){a.newItemName=a.item.name,a.isEditing=!1}function g(){b.remove(a.item.id)}function h(c){b.editItem(a.item.id,"assigned_to_id",c)}a.assignItem=h,a.itemCheck=a.item.is_checked,a.setCheckBox=c,a.newItemName=a.item.name,a.isEditing=!1,a.startItemEdit=d,a.cancelItemEdit=f,a.saveItemEdit=e,a.deleteItem=g}function k(a,b,a,c,d){function e(){d.clearAll(),a.go("users"),c.location.reload()}function f(){d.clearAll(),d.set("auto_increment",0),d.set("users",[]),d.set("lists",[]),d.set("items",[]),d.set("comments",[]),a.go("users"),c.location.reload()}b.resetBasketAppClearAll=f,b.resetBasketAppDemoData=e}function l(a,b){b.otherwise("/users"),a.state("users",{url:"/users",templateUrl:"templates/users.html",controller:"UserSelectCtrl"}).state("user",{"abstract":!0,url:"/users/{userId:int}",templateUrl:"templates/user.html",controller:"UserCtrl"}).state("user.lists",{url:"/lists",templateUrl:"templates/user.lists.html"}).state("user.edit",{url:"/edit",templateUrl:"templates/user.edit.html"}).state("list",{"abstract":!0,url:"/users/{userId:int}/lists/{listId:int}",controller:"ListCtrl",templateUrl:"templates/list.html"}).state("list.items",{url:"/items?sort&rev",templateUrl:"templates/list.items.html",params:{sort:{value:"added",squash:!0}}}).state("list.edit",{url:"/edit",templateUrl:"templates/list.edit.html"})}function m(a,b,c,d,e,f,g){if(a.$on("$stateChangeError",console.log.bind(console)),null===b.get("auto_increment")){b.clearAll(),b.set("auto_increment",0),c.init();var h=d.createNew("Jake"),i=d.createNew("Jill"),j=e.createNew(h.id,"My List"),k=e.createNew(i.id,"My List 2");k.shared_with.push(h.id),h.last_list=j.id,i.last_list=k.id,b.set("users",[h,i]),b.set("lists",[j,k]);var l=[f.createNew(h.id,j.id,"cheese"),f.createNew(h.id,j.id,"wallet"),f.createNew(h.id,j.id,"pants"),f.createNew(i.id,k.id,"apples"),f.createNew(i.id,k.id,"dogfood"),f.createNew(i.id,k.id,"rocks")];b.set("items",l),b.set("comments",[g.createNew(h.id,l[0].id,"From cheese store"),g.createNew(h.id,l[4].id,"Tasty apples only, please"),g.createNew(i.id,l[4].id,"I like tasty apples"),g.createNew(i.id,l[5].id,"For the dog")])}c.init(),d.init(),e.init(),f.init(),g.init()}angular.module("services",[]),angular.module("controllers",[]),angular.module("filters",[]),angular.module("services").factory("StorageService",a),angular.module("services").factory("IdService",b),b.$inject=["StorageService"],angular.module("services").factory("Lists",c),c.$inject=["IdService","StorageService"],angular.module("services").factory("Users",d),d.$inject=["IdService","StorageService"],angular.module("services").factory("Items",e),e.$inject=["IdService","StorageService"],angular.module("services").factory("Comments",f),f.$inject=["IdService","StorageService"],angular.module("controllers").controller("UserSelectCtrl",g),g.$inject=["$scope","$state","Users"],angular.module("controllers").controller("UserCtrl",h),h.$inject=["$scope","$state","$stateParams","Lists","Users","Items"],angular.module("controllers").controller("ListCtrl",i),i.$inject=["$scope","$state","$stateParams","Lists","Users","Items","Comments","Mailto","$window","$interpolate","$filter"],angular.module("controllers").controller("ItemCtrl",j),j.$inject=["$scope","Items"],angular.module("controllers").controller("AppCtrl",k),k.$inject=["$state","$scope","$state","$window","StorageService"],angular.module("filters").filter("userHasAccess",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){if(a.owner_id===b)this.push(a);else{var c=this;a.shared_with.forEach(function(d){d===b&&c.push(a)})}},c),c}}).filter("assignableUsers",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){if(b.owner_id===a.id)this.push(a);else{var c=this;b.shared_with.forEach(function(b){b===a.id&&c.push(a)})}},c),c}}).filter("excludeUser",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.id!==b.id&&this.push(a)},c),c}}).filter("itemInList",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.list_id===b&&this.push(a)},c),c}}).filter("commentForItem",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.item_id===b&&this.push(a)},c),c}}),angular.module("basketApp",["ui.bootstrap","ui.router","uz.mailto","services","filters","controllers"]).config(l).run(m),l.$inject=["$stateProvider","$urlRouterProvider"],m.$inject=["$rootScope","StorageService","IdService","Users","Lists","Items","Comments"]}();
//# sourceMappingURL=application.js.map